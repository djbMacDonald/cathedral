"use strict";function MainCtrl(a,b){var c=this;c.things=["1","2","3"],c.points=a.points,c.doStuff=function(){a.iterate(),c.draw()},c.draw=function(){b.d3().then(function(a){function b(){console.log("zoom"),k.attr("transform","translate("+e.left+","+e.top+")translate("+a.event.translate+")scale("+a.event.scale+")")}var d=c.points,e={top:50,right:50,bottom:50,left:50},f=500-e.left-e.right,g=500-e.top-e.bottom,h=a.scale.linear().range([0,f]),i=a.scale.linear().range([g,0]),j=a.svg.line().x(function(a){return h(a.x)}).y(function(a){return i(a.y)});a.select("body").selectAll("svg").remove();var k=a.select("#graph").append("svg").attr("width",f+e.left+e.right).attr("height",g+e.top+e.bottom).append("g").attr("class","something").attr("transform","translate("+e.left+","+e.top+")");d.forEach(function(a){a.x=a.x,a.y=+a.y});var l=a.min(d,function(a){return a.x}),m=a.min(d,function(a){return a.y}),n=a.max(d,function(a){return a.x}),o=a.max(d,function(a){return a.y});h.domain([_.min([l,m]),_.max([n,o])]),i.domain([_.min([l,m]),_.max([n,o])]),k.append("path").datum(d).attr("class","line").attr("d",j),a.select("svg").call(a.behavior.zoom().scaleExtent([1,10]).on("zoom",b)),a.select("svg").call(a.behavior.drag())})},c.draw()}function replacementGraph(a){return{restrict:"EA",templateUrl:"views/partials/replacement.html",controller:"MainCtrl",controllerAs:"main",bindToController:!0}}angular.module("fractalApp",["ngRoute","d3","MainDirective"]),angular.module("fractalApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("d3",[]).factory("d3Service",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="bower_components/d3/d3.js",f.onreadystatechange=function(){"complete"===this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),angular.module("fractalApp").factory("GraphFactory",[function(){var a=[{x:0,y:1},{x:0,y:0},{x:1,y:0}],b=[];b.push(a),b=_.flatten(b);var c=function(){for(var c=[],i=d(a[0],a.slice(-1)[0]),k=f(a[0],a.slice(-1)[0]),l=0;l<b.length-1;l++){var m=f(b[l],b[l+1]);console.log(m);var n=g(a,m-k),o=d(b[l],b[l+1]);n=e(n,o/i),n=h(n,b[l]),c.push(n)}c=_.flatten(c),c=j(c),angular.copy(c,b)},d=function(a,b){var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y);return Math.sqrt(Math.pow(c,2)+Math.pow(d,2))},e=function(a,b){return a.map(function(a){return{x:a.x*b,y:a.y*b}})},f=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=Math.PI/2;return 0!==c&&(e=Math.atan(d/c)),0>c?e+Math.PI:c>0&&0>d?e+2*Math.PI:0===c&&0>d?e+Math.PI:e},g=function(a,b){var c=[[Math.cos(b),-Math.sin(b)],[Math.sin(b),Math.cos(b)]];return a.map(function(a){return i(c,a)})},h=function(a,b){return a.map(function(c){return{x:c.x-a[0].x+b.x,y:c.y-a[0].y+b.y}})},i=function(a,b){var c=a[0][0]*b.x+a[0][1]*b.y,d=a[1][0]*b.x+a[1][1]*b.y;return{x:c,y:d}},j=function(a){for(var b=0;b<a.length-1;b++)a[b].x===a[b+1].x&&a[b].y===a[b+1].y&&(a[b]=null);return _.compact(a)};return{points:b,iterate:c}}]),angular.module("fractalApp").controller("MainCtrl",MainCtrl),MainCtrl.$inject=["GraphFactory","d3Service"],angular.module("MainDirective",[]),angular.module("MainDirective").directive("replacementGraph",["d3Service",replacementGraph]);