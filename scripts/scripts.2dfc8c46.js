"use strict";function MainCtrl(a,b,c){var d=this;d.points=a.points,d.seed=a.seed,d.iterateFurther=function(){d.loading=!0,c(function(){a.iterate(),d.draw()}),c(function(){d.loading=!1},100)},d.addNode=function(){a.addNode(),d.createInput(),a.setPointsToSeed(),d.drawFourth()},d.removeNode=function(){a.removeNode(),d.createInput(),a.setPointsToSeed(),d.drawFourth()},d.reset=function(){a.seed=[{x:7,y:13},{x:7,y:7},{x:13,y:7}],a.points=a.seed,angular.copy(a.seed,d.seed),angular.copy(a.points,d.points),d.drawFourth(),d.createInput()},d.drawFourth=function(){a.setPointsToSeed(),a.iterate(),a.iterate(),a.iterate(),a.iterate(),d.draw()},d.createInput=function(){b.d3().then(function(a){function b(){return a.svg.axis().scale(n).orient("bottom").ticks(20)}function c(){return a.svg.axis().scale(o).orient("left").ticks(20)}function e(a){}function f(b,c){b.x+=r(a.event.dx),b.y-=s(a.event.dy),b.x=Math.max(0,b.x),b.x=Math.min(b.x,20),b.y=Math.max(0,b.y),b.y=Math.min(b.y,20),a.select(this).attr("cx",n(b.x)),a.select(this).attr("cy",o(b.y)),a.selectAll(".input path").remove(),i(),d.drawFourth()}function g(b){b.x=Math.round(b.x),b.y=Math.round(b.y),a.selectAll("circle").remove(),a.selectAll("path").remove(),i(),j(),d.drawFourth()}function h(){q.append("g").attr("class","grid").attr("transform","translate(0,"+m+")").call(b().tickSize(-m,0,0).tickFormat("")),q.append("g").attr("class","grid").call(c().tickSize(-l,0,0).tickFormat(""))}function i(){q.append("path").datum(d.seed).attr("class","line").attr("d",p).style("stroke-width",2).attr("stroke","steelblue")}function j(){q.selectAll("circle.line").data(d.seed).enter().append("circle").attr("class","circle").attr("cx",function(a){return n(a.x)}).attr("cy",function(a){return o(a.y)}).attr("r",6).attr("fill","black"),a.selectAll(".circle").call(a.behavior.drag().on("dragstart",e).on("drag",f).on("dragend",g))}$(".input").remove();var k={top:20,right:20,bottom:20,left:20},l=300-k.left-k.right,m=300-k.top-k.bottom,n=a.scale.linear().range([0,l]),o=a.scale.linear().range([m,0]),p=a.svg.line().x(function(a){return n(a.x)}).y(function(a){return o(a.y)}),q=a.select("#inputArea").append("svg").attr("class","input").attr("width",l+k.left+k.right).attr("height",m+k.top+k.bottom).append("g").attr("transform","translate("+k.left+","+k.top+")");n.domain([0,20]),o.domain([0,20]);var r=a.scale.linear().domain([0,l]).range([0,20]),s=a.scale.linear().domain([0,m]).range([0,20]);h(),i(),j()})},d.draw=function(){b.d3().then(function(a){function b(){j.attr("transform","translate("+c.left+","+c.top+")translate("+a.event.translate+")scale("+a.event.scale+")"),r.style("stroke-width",2/a.event.scale),s.style("stroke-width",.3/a.event.scale)}$(".replacementGraph").remove();var c={top:50,right:50,bottom:50,left:50},e=500-c.left-c.right,f=500-c.top-c.bottom,g=a.scale.linear().range([0,e]),h=a.scale.linear().range([f,0]),i=a.svg.line().x(function(a){return g(a.x)}).y(function(a){return h(a.y)}),j=a.select("#graph").append("svg").attr("class","replacementGraph").attr("width",e+c.left+c.right).attr("height",f+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")"),k=a.min(d.points,function(a){return a.x}),l=a.min(d.points,function(a){return a.y}),m=a.max(d.points,function(a){return a.x}),n=a.max(d.points,function(a){return a.y}),o=m-k,p=n-l,q=Math.max(o,p);g.domain([k,k+q]),h.domain([l,l+q]);var r=j.append("path").datum(d.points).attr("class","line").attr("d",i).style("stroke-width",2).attr("stroke","steelblue"),s=j.append("path").datum(d.seed).attr("class","line").attr("d",i).style("stroke-width",.3).attr("stroke","red");a.select(".replacementGraph").call(a.behavior.zoom().scaleExtent([1,10]).on("zoom",b)),a.select(".replacementGraph").call(a.behavior.drag())})},d.init=function(){0===$("svg").length&&(d.createInput(),d.drawFourth())},d.init()}function replacementGraph(){return{restrict:"EA",templateUrl:"views/partials/replacement.html",controller:"MainCtrl",controllerAs:"main",bindToController:!0}}function loadingModal(){return{restrict:"EA",templateUrl:"views/partials/loading.html",controller:"MainCtrl",controllerAs:"main",bindToController:!0}}angular.module("fractalApp",["ngRoute","d3","MainDirective"]),angular.module("fractalApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html"}).otherwise({redirectTo:"/"})}]),angular.module("d3",[]).factory("d3Service",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="bower_components/d3/d3.js",f.onreadystatechange=function(){"complete"===this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),angular.module("fractalApp").factory("GraphFactory",[function(){var a=[{x:7,y:13},{x:7,y:7},{x:13,y:7}],b=[];b.push(a),b=_.flatten(b);var c=function(){for(var c=[],d=g(a[0],a.slice(-1)[0]),e=i(a[0],a.slice(-1)[0]),f=0;f<b.length-1;f++){var l=i(b[f],b[f+1]),n=j(a,l-e),o=g(b[f],b[f+1]);n=h(n,o/d),n=k(n,b[f]),c.push(n)}c=_.flatten(c),c=m(c),angular.copy(c,b)},d=function(){angular.copy(a,b)},e=function(){var b=Math.floor(11*Math.random()),c=Math.floor(11*Math.random());a.push({x:b,y:c})},f=function(){a.pop()},g=function(a,b){var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y);return Math.sqrt(Math.pow(c,2)+Math.pow(d,2))},h=function(a,b){return a.map(function(a){return{x:a.x*b,y:a.y*b}})},i=function(a,b){var c=b.x-a.x,d=b.y-a.y,e=Math.PI/2;return 0!==c&&(e=Math.atan(d/c)),0>c?e+Math.PI:c>0&&0>d?e+2*Math.PI:0===c&&0>d?e+Math.PI:e},j=function(a,b){var c=[[Math.cos(b),-Math.sin(b)],[Math.sin(b),Math.cos(b)]];return a.map(function(a){return l(c,a)})},k=function(a,b){return a.map(function(c){return{x:c.x-a[0].x+b.x,y:c.y-a[0].y+b.y}})},l=function(a,b){var c=a[0][0]*b.x+a[0][1]*b.y,d=a[1][0]*b.x+a[1][1]*b.y;return{x:c,y:d}},m=function(a){for(var b=0;b<a.length-1;b++)a[b].x===a[b+1].x&&a[b].y===a[b+1].y&&(a[b]=null);return _.compact(a)};return{points:b,iterate:c,seed:a,setPointsToSeed:d,addNode:e,removeNode:f}}]),angular.module("fractalApp").controller("MainCtrl",MainCtrl),MainCtrl.$inject=["GraphFactory","d3Service","$timeout"],angular.module("MainDirective",[]),angular.module("MainDirective").directive("replacementGraph",replacementGraph),angular.module("MainDirective").directive("loadingModal",loadingModal);